# E-commerce Site

Example of an e-commerce site with products, orders, and customers.

## Schema Definition

```prisma filename="schema.prisma"
generator zodMock {
  provider = "prisma-zod-mock"
  output   = "./generated"
  locale   = "en"
}

model Customer {
  id            String   @id @default(cuid())
  /// @mock faker.internet.email()
  email         String   @unique
  /// @mock faker.person.fullName()
  name          String
  /// @mock faker.phone.number()
  phone         String?
  /// @mock faker.location.streetAddress()
  address       String?
  /// @mock faker.location.city()
  city          String?
  /// @mock faker.location.zipCode()
  zipCode       String?
  /// @mock faker.location.country()
  country       String?
  orders        Order[]
  cart          CartItem[]
  reviews       Review[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Product {
  id            String   @id @default(cuid())
  /// @mock faker.commerce.productName()
  name          String
  /// @mock faker.lorem.slug(3)
  slug          String   @unique
  /// @mock faker.commerce.productDescription()
  description   String
  /// @mock faker.number.float({ min: 10, max: 1000, fractionDigits: 2 })
  price         Float
  /// @mock faker.number.int({ min: 0, max: 100 })
  discount      Int      @default(0)
  /// @mock faker.number.int({ min: 0, max: 1000 })
  stock         Int      @default(0)
  /// @mock faker.commerce.productMaterial()
  category      String
  /// @mock faker.image.url()
  imageUrl      String
  /// @mock faker.datatype.boolean()
  featured      Boolean  @default(false)
  orderItems    OrderItem[]
  cartItems     CartItem[]
  reviews       Review[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Order {
  id            String      @id @default(cuid())
  /// @mock faker.string.alphanumeric(10).toUpperCase()
  orderNumber   String      @unique
  customer      Customer    @relation(fields: [customerId], references: [id])
  customerId    String
  items         OrderItem[]
  /// @mock faker.number.float({ min: 10, max: 5000, fractionDigits: 2 })
  subtotal      Float
  /// @mock faker.number.float({ min: 0, max: 50, fractionDigits: 2 })
  tax           Float
  /// @mock faker.number.float({ min: 0, max: 20, fractionDigits: 2 })
  shipping      Float
  total         Float
  /// @mock faker.helpers.arrayElement(["pending", "processing", "shipped", "delivered", "cancelled"])
  status        String      @default("pending")
  /// @mock faker.helpers.arrayElement(["credit_card", "paypal", "bank_transfer"])
  paymentMethod String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model OrderItem {
  id          String   @id @default(cuid())
  order       Order    @relation(fields: [orderId], references: [id])
  orderId     String
  product     Product  @relation(fields: [productId], references: [id])
  productId   String
  /// @mock faker.number.int({ min: 1, max: 10 })
  quantity    Int
  /// @mock faker.number.float({ min: 10, max: 1000, fractionDigits: 2 })
  price       Float
}

model CartItem {
  id          String   @id @default(cuid())
  customer    Customer @relation(fields: [customerId], references: [id])
  customerId  String
  product     Product  @relation(fields: [productId], references: [id])
  productId   String
  /// @mock faker.number.int({ min: 1, max: 10 })
  quantity    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Review {
  id          String   @id @default(cuid())
  customer    Customer @relation(fields: [customerId], references: [id])
  customerId  String
  product     Product  @relation(fields: [productId], references: [id])
  productId   String
  /// @mock faker.number.int({ min: 1, max: 5 })
  rating      Int
  /// @mock faker.lorem.sentence()
  title       String
  /// @mock faker.lorem.paragraph()
  comment     String
  /// @mock faker.datatype.boolean()
  verified    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

## Using Generated Mocks

### Creating Test Data

```typescript
import {
  createCustomerMock,
  createProductMock,
  createOrderMock,
  createOrderItemMock,
  createReviewMock,
} from './generated';

// Create products
const products = Array.from({ length: 20 }).map(() => createProductMock());

// Create customers
const customers = Array.from({ length: 10 }).map(() => createCustomerMock());

// Create orders with items
const orders = customers.map((customer) => {
  const orderProducts = products
    .sort(() => 0.5 - Math.random())
    .slice(0, Math.floor(Math.random() * 5) + 1);

  const items = orderProducts.map((product) =>
    createOrderItemMock({
      productId: product.id,
      price: product.price * (1 - product.discount / 100),
    })
  );

  const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const tax = subtotal * 0.1;
  const shipping = subtotal > 100 ? 0 : 10;

  return createOrderMock({
    customerId: customer.id,
    subtotal,
    tax,
    shipping,
    total: subtotal + tax + shipping,
  });
});
```

### E-commerce Service Tests

```typescript filename="ecommerce.test.ts"
import { createProductMock, createCustomerMock, createOrderMock } from './generated';
import { EcommerceService } from './ecommerce.service';

describe('EcommerceService', () => {
  let service: EcommerceService;

  beforeEach(() => {
    service = new EcommerceService();
  });

  describe('Cart Operations', () => {
    it('should add product to cart', async () => {
      const customer = createCustomerMock();
      const product = createProductMock({ stock: 10 });

      const cartItem = await service.addToCart(customer.id, product.id, 2);

      expect(cartItem).toMatchObject({
        customerId: customer.id,
        productId: product.id,
        quantity: 2,
      });
    });

    it('should calculate cart total', async () => {
      const customer = createCustomerMock();
      const products = [
        createProductMock({ price: 100, discount: 10 }),
        createProductMock({ price: 50, discount: 0 }),
      ];

      for (const product of products) {
        await service.addToCart(customer.id, product.id, 1);
      }

      const total = await service.calculateCartTotal(customer.id);
      expect(total).toBe(140); // (100 * 0.9) + 50
    });
  });

  describe('Order Processing', () => {
    it('should create order from cart', async () => {
      const customer = createCustomerMock();
      const product = createProductMock({
        price: 100,
        stock: 5,
      });

      await service.addToCart(customer.id, product.id, 2);

      const order = await service.checkout(customer.id, 'credit_card');

      expect(order).toMatchObject({
        customerId: customer.id,
        status: 'pending',
        paymentMethod: 'credit_card',
        subtotal: 200,
        total: expect.any(Number),
      });
    });

    it('should update product stock after order', async () => {
      const initialStock = 10;
      const product = createProductMock({
        stock: initialStock,
      });
      const orderQuantity = 3;

      await service.processOrder(createOrderMock(), [
        { productId: product.id, quantity: orderQuantity },
      ]);

      const updatedProduct = await service.getProduct(product.id);
      expect(updatedProduct.stock).toBe(initialStock - orderQuantity);
    });
  });
});
```

### Database Seeding

```typescript filename="seed.ts"
import { PrismaClient } from '@prisma/client';
import {
  createCustomerMock,
  createProductMock,
  createOrderMock,
  createOrderItemMock,
  createReviewMock,
} from './generated';

const prisma = new PrismaClient();

async function seed() {
  // Create categories of products
  const categories = ['Electronics', 'Clothing', 'Books', 'Home'];

  const products = await Promise.all(
    categories.flatMap((category) =>
      Array.from({ length: 10 }).map(() =>
        prisma.product.create({
          data: createProductMock({
            category,
            featured: Math.random() > 0.8,
          }),
        })
      )
    )
  );

  // Create customers
  const customers = await Promise.all(
    Array.from({ length: 20 }).map(() =>
      prisma.customer.create({
        data: createCustomerMock(),
      })
    )
  );

  // Create orders and reviews
  for (const customer of customers) {
    // Create 1-3 orders per customer
    const orderCount = Math.floor(Math.random() * 3) + 1;

    for (let i = 0; i < orderCount; i++) {
      const orderProducts = products
        .sort(() => 0.5 - Math.random())
        .slice(0, Math.floor(Math.random() * 5) + 1);

      const order = await prisma.order.create({
        data: {
          ...createOrderMock({ customerId: customer.id }),
          items: {
            create: orderProducts.map((product) =>
              createOrderItemMock({
                productId: product.id,
                price: product.price * (1 - product.discount / 100),
              })
            ),
          },
        },
      });

      // Add reviews for ordered products
      for (const product of orderProducts) {
        if (Math.random() > 0.5) {
          await prisma.review.create({
            data: createReviewMock({
              customerId: customer.id,
              productId: product.id,
              verified: true,
            }),
          });
        }
      }
    }
  }

  console.log('E-commerce database seeded successfully!');
}

seed()
  .catch(console.error)
  .finally(() => prisma.$disconnect());
```
