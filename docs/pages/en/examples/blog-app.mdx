# Blog Application

Example of a blog application with users, posts, and comments.

## Schema Definition

```prisma filename="schema.prisma"
generator zodMock {
  provider = "prisma-zod-mock"
  output   = "./generated"
}

model User {
  id        String   @id @default(cuid())
  /// @mock faker.internet.email()
  email     String   @unique
  /// @mock faker.person.fullName()
  name      String
  /// @mock faker.person.bio()
  bio       String?
  /// @mock faker.image.avatar()
  avatar    String?
  posts     Post[]
  comments  Comment[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id        String   @id @default(cuid())
  /// @mock faker.lorem.sentence()
  title     String
  /// @mock faker.lorem.slug(3)
  slug      String   @unique
  /// @mock faker.lorem.paragraphs(5)
  content   String
  /// @mock faker.helpers.arrayElement(["draft", "published", "archived"])
  status    String   @default("draft")
  /// @mock faker.number.int({ min: 0, max: 10000 })
  views     Int      @default(0)
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  comments  Comment[]
  tags      Tag[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  /// @mock faker.date.recent({ days: 30 })
  publishedAt DateTime?
}

model Comment {
  id        String   @id @default(cuid())
  /// @mock faker.lorem.paragraph()
  content   String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tag {
  id    String @id @default(cuid())
  /// @mock faker.lorem.word()
  name  String @unique
  posts Post[]
}
```

## Using Generated Mocks

### Creating Test Data

```typescript
import { createUserMock, createPostMock, createCommentMock, createTagMock } from './generated';

// Create a user
const user = createUserMock();

// Create posts for the user
const posts = Array.from({ length: 5 }).map(() =>
  createPostMock({
    authorId: user.id,
    status: 'published',
    publishedAt: new Date(),
  })
);

// Create comments on posts
const comments = posts.flatMap((post) =>
  Array.from({ length: 3 }).map(() =>
    createCommentMock({
      postId: post.id,
      authorId: user.id,
    })
  )
);

// Create tags
const tags = ['JavaScript', 'TypeScript', 'React', 'Node.js'].map((name) =>
  createTagMock({ name })
);
```

### Database Seeding Script

```typescript filename="seed.ts"
import { PrismaClient } from '@prisma/client';
import { createUserMock, createPostMock, createCommentMock, createTagMock } from './generated';

const prisma = new PrismaClient();

async function seed() {
  console.log('Seeding database...');

  // Create tags
  const tags = await Promise.all(
    ['JavaScript', 'TypeScript', 'React', 'Node.js', 'Prisma'].map((name) =>
      prisma.tag.create({
        data: createTagMock({ name }),
      })
    )
  );

  // Create users
  const users = await Promise.all(
    Array.from({ length: 10 }).map(() =>
      prisma.user.create({
        data: createUserMock(),
      })
    )
  );

  // Create posts with tags
  for (const user of users) {
    const userPosts = await Promise.all(
      Array.from({ length: 3 }).map(() => {
        const randomTags = tags
          .sort(() => 0.5 - Math.random())
          .slice(0, Math.floor(Math.random() * 3) + 1);

        return prisma.post.create({
          data: {
            ...createPostMock({
              authorId: user.id,
              status: 'published',
            }),
            tags: {
              connect: randomTags.map((tag) => ({ id: tag.id })),
            },
          },
        });
      })
    );

    // Create comments on posts
    for (const post of userPosts) {
      const commentAuthors = users
        .filter((u) => u.id !== user.id)
        .sort(() => 0.5 - Math.random())
        .slice(0, Math.floor(Math.random() * 5) + 1);

      await Promise.all(
        commentAuthors.map((author) =>
          prisma.comment.create({
            data: createCommentMock({
              postId: post.id,
              authorId: author.id,
            }),
          })
        )
      );
    }
  }

  console.log('Seeding completed!');
}

seed()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```

## Testing Example

```typescript filename="blog.test.ts"
import { createUserMock, createPostMock } from './generated';
import { BlogService } from './blog.service';

describe('BlogService', () => {
  let blogService: BlogService;

  beforeEach(() => {
    blogService = new BlogService();
  });

  it('should create a new post', async () => {
    const author = createUserMock();
    const postData = createPostMock({
      authorId: author.id,
    });

    const result = await blogService.createPost(postData);

    expect(result).toMatchObject({
      title: postData.title,
      content: postData.content,
      authorId: author.id,
    });
  });

  it('should publish a draft post', async () => {
    const draftPost = createPostMock({
      status: 'draft',
      publishedAt: null,
    });

    const publishedPost = await blogService.publishPost(draftPost.id);

    expect(publishedPost.status).toBe('published');
    expect(publishedPost.publishedAt).toBeTruthy();
  });
});
```
