# 型定義

prisma-zod-mockで生成される型定義のリファレンスです。

## 基本型

### モデル型

Prismaクライアントの型と同等の型が使用されます：

```typescript
// Prismaモデル
model User {
  id        String
  email     String
  name      String?
  createdAt DateTime
}

// 使用される型（@prisma/clientから）
type User = {
  id: string;
  email: string;
  name: string | null;
  createdAt: Date;
}
```

### 入力型

作成や更新用の入力型：

```typescript
// 作成用入力型
type UserCreateInput = {
  email: string;
  name?: string | null;
  // id, createdAtは自動生成のため含まれない
}

// 更新用入力型
type UserUpdateInput = {
  email?: string;
  name?: string | null;
}
```

## リレーション型

### 基本的なリレーション

```typescript
// 1対多のリレーション
type UserWithPosts = User & {
  posts: Post[];
}

// 1対1のリレーション
type UserWithProfile = User & {
  profile: Profile | null;
}
```

### ネストしたリレーション

```typescript
type PostWithFullRelations = Post & {
  author: User & {
    profile: Profile | null;
  };
  comments: (Comment & {
    author: User;
  })[];
  tags: Tag[];
}
```

## ユーティリティ型

### DeepPartial

ネストしたオブジェクトも含めて部分的にする型：

```typescript
type DeepPartial<T> = {
  [P in keyof T]?: T[P] extends object
    ? DeepPartial<T[P]>
    : T[P];
}

// 使用例
type PartialUserWithRelations = DeepPartial<UserWithPosts>;
```

### Nullable

null許容型：

```typescript
type Nullable<T> = T | null;

// 使用例
type NullableUser = Nullable<User>;
```

## ファクトリー関数の型

### 基本ファクトリー型

```typescript
type MockFactory<T> = (overrides?: Partial<T>) => T;

// 実装例
const createUserMock: MockFactory<User> = (overrides) => {
  return {
    id: 'default-id',
    email: 'default@example.com',
    name: null,
    createdAt: new Date(),
    ...overrides
  };
};
```

### バッチファクトリー型

```typescript
type BatchMockFactory<T> = (
  count: number,
  overrides?: Partial<T>
) => T[];
```

### リレーションファクトリー型

```typescript
type RelationMockFactory<T> = (
  overrides?: DeepPartial<T>
) => T;
```

## Zodスキーマ型

### スキーマから型を推論

```typescript
import { z } from 'zod';
import { UserSchema } from './generated';

// スキーマから型を推論
type UserFromSchema = z.infer<typeof UserSchema>;

// 入力型
type UserInput = z.input<typeof UserSchema>;

// 出力型
type UserOutput = z.output<typeof UserSchema>;
```

### カスタムスキーマ型

```typescript
// 厳密な型定義
type StrictUserSchema = z.ZodObject<{
  id: z.ZodString;
  email: z.ZodString;
  name: z.ZodNullable<z.ZodString>;
  createdAt: z.ZodDate;
}>;
```

## 条件型

### オプショナルフィールドの処理

```typescript
// Prismaのオプショナルフィールドを適切に型付け
type OptionalFields<T> = {
  [K in keyof T as undefined extends T[K] ? K : never]?: T[K];
};

type RequiredFields<T> = {
  [K in keyof T as undefined extends T[K] ? never : K]: T[K];
};

type StrictModel<T> = OptionalFields<T> & RequiredFields<T>;
```

## ジェネリック型

### ページネーション型

```typescript
type PaginatedResult<T> = {
  data: T[];
  total: number;
  page: number;
  pageSize: number;
  hasNext: boolean;
  hasPrev: boolean;
};

// 使用例
type PaginatedUsers = PaginatedResult<User>;
```

### APIレスポンス型

```typescript
type ApiResponse<T> = {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
  };
};

// 使用例
type UserResponse = ApiResponse<User>;
type UsersResponse = ApiResponse<User[]>;
```

## 型ガード

生成される型で使用できる型ガード：

```typescript
// null チェック
function isNotNull<T>(value: T | null): value is T {
  return value !== null;
}

// 配列の型ガード
function isUserArray(value: unknown): value is User[] {
  return Array.isArray(value) && 
    value.every(item => UserSchema.safeParse(item).success);
}

// 使用例
const users = [createUserMock(), null, createUserMock()];
const validUsers = users.filter(isNotNull); // User[]型
```